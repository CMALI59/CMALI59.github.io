<!DOCTYPE html>

<html lang="en">

<html>
<head>

		<title>College Debt Estimator</title>

		<!-- bootstrap 4 -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />

		<!-- custom css -->
		<style>
			td, th, td input {text-align: right;}
      #loan_table {background-color: pink;}
			p {color: red;}
		</style>

	</head>

	<body onload="">

		<div class="container" ng-app="myApp" ng-controller="myCtrl">

			<form>

				<h1>College Debt Estimator</h1>
				<p> Warning!!!!! please check that the values for year, amount and interest rate are valid inputs if not the totals will not calculate and will display an alert of the error when the calculate button is clicked</p>
					
				
				<br />

				<div class="row">      
					<div class="col-lg-6">
						<div class="form-group">
						
							<h2>Loans</h2>

							<table class="table" id="loan_table">
								<tr>
									<th>Year</th>
									<th>Amount</th>
									<th>Int Rate<a target="_blank" href="https://studentaid.ed.gov/sa/types/loans/interest-rates"><sup>1</sup></a></th>
									<th>YE Bal</th>
								</tr>
								<tr>
									<td><input type="text" class="form-control" placeholder="2020" id="loan_year01" /></td>
									<td><input type="text" class="form-control" placeholder="$10,000.00" id="loan_amt01" /></td>
									<td><input type="text" class="form-control" placeholder="0.0453" id="loan_int01" /></td>
									<td><span id="loan_bal01">$10,453.00</span></td>
								</tr>
								<tr>
									<td><input type="text" class="form-control" placeholder="2021" id="loan_year02" /></td>
									<td><input type="text" class="form-control" placeholder="$10,000.00" id="loan_amt02" /></td>
									<td><input type="text" class="form-control" placeholder="0.0453" id="loan_int02" /></td>
									<td><span id="loan_bal02">$21,379.52</span></td>
								</tr>
								<tr>
									<td><input type="text" class="form-control" placeholder="2022" id="loan_year03" /></td>
									<td><input type="text" class="form-control" placeholder="$10,000.00" id="loan_amt03" /></td>
									<td><input type="text" class="form-control" placeholder="0.0453" id="loan_int03" /></td>
									<td><span id="loan_bal03">$32,801.01</span></td>
								</tr>
								<tr>
									<td><input type="text" class="form-control" placeholder="2023" id="loan_year04" /></td>
									<td><input type="text" class="form-control" placeholder="$10,000.00" id="loan_amt04" /></td>
									<td><input type="text" class="form-control" placeholder="0.0453" id="loan_int04" /></td>
									<td><span id="loan_bal04">$44,739.90</span></td>
								</tr>
								<tr>
									<td><input type="text" class="form-control" placeholder="2024" id="loan_year05" /></td>
									<td><input type="text" class="form-control" placeholder="$10,000.00" id="loan_amt05" /></td>
									<td><input type="text" class="form-control" placeholder="0.0453" id="loan_int05" /></td>
									<td><span id="loan_bal05">$57,219.62</span></td>
								</tr>
								<tr>
									<td colspan="3">Interest accrued while attending college:</td>
									<td><span id="loan_int_accrued">$7,219.62</span></td>
								</tr>
							</table>
							<br />
							
      
<button type="button" class="btn btn-primary" ng-click= "verifyYEAR(); verifyAMOUNT(); verifyINTEREST; populate()">Re-calculate</button> <!-- make sure the button to calculate results has the angular directive -->
						</div>
					</div>

					<div class="col-lg-6">
						<div class="form-group">
						
							<h2>Payments</h2>
							
							<table class="table">
								<tr>
									<th>Year</th>
									<th>Payments</th>
									<th>Int Amt</th>
									<th>YE Bal</th>
								</tr>
								<tr ng-repeat="x in payments"> <!-- Data binding, binds AngularJS expressions with AngularJS data. i.e. year payment, amount and balance-->
										<td>{{ x.year }}</td>
										<td>{{ x.payment }}</td>
										<td>{{ x.amt }}</td>
										<td>{{ x.bal }}</td>
								
							</table>
						</div>
					</div>

				</div>

			</form>

		</div>
    
    <!--- jquery 3.4.1 -->
		<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
      <!--- Adding angualr,  AngularJS is distributed as a JavaScript file, and can be added to a web page with a script tag -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script> 

	<script>   
	// --- global variables ---
var loans = [
  { loan_year: 2020, loan_amount: 10000.00, loan_int_rate: 0.0453 },
  { loan_year: 2021, loan_amount: 10000.00, loan_int_rate: 0.0453 },
  { loan_year: 2022, loan_amount: 10000.00, loan_int_rate: 0.0453 },
  { loan_year: 2023, loan_amount: 10000.00, loan_int_rate: 0.0453 },
  { loan_year: 2024, loan_amount: 10000.00, loan_int_rate: 0.0453 }
]; 
//Storeloans array data using localStorage.
//localStorage["loans"] = JSON.stringify(datas);
// Retrieve
//var stored_loans = JSON.parse(localStorage["loans"]);

// --- function: loadDoc() ---

//regular expressions to validate input fields
function verifyYEAR(){ //create a function to verify the input of year
  var regex = /^\d{4}$/; // year enetered has to be 4 digits 
  var id = document.getElementById("loan_year01").value; //verifies year from the first user input of the year
  if(regex.test(id))document.getElementById("msg").innerHTML = ""; //Checks with if statement if entered input is a number and has 4.
  else
	  alert("Year must be four digits even if it starts with zero and ends with one"); // alert why the year is rejected
	}
function verifyAMOUNT(){ //create a function to verify the input of amount
  var regex = /^([1-9][0-9]*)|([0]+)$/; // amount enetered cant start wit 0 & has to be a number 
  var id = document.getElementById("loan_amt01").value; //verifies amount from the first user input is an actual number
  if(regex.test(id))document.getElementById("msg").innerHTML = ""; //Checks with if statement if entered input is valid.
  else 
	  alert("Loan amount cannot start with zero"); // alert why the number is rejected
	}
function verifyINTEREST(){ //create a function to verify the input of interest rate
  var regex = /^\d{1,2}(\.\d{1,4})?$/; // interest enetered can have two numbers before the decimal and up to 4 numbers after the decimal
  var id = document.getElementById("loan_int01").value; //verifies interest rate from the first user input is a valid number
  if(regex.test(id))document.getElementById("msg").innerHTML = ""; //Checks with if statement if entered input is valid.
  else 
	  alert("Enter a valid interest number starting with a zero before the decimal"); // alert why the interest number is rejected
	}

//function loadDoc() {
//changing JavaScript to Jquery
$(document).ready(function(){
  
  // pre-fill defaults for first loan year
  var defaultYear = loans[0].loan_year;
  $("#loan_year0" + 1).val = defaultYear++; //javascript to Jquery, setting default year (increments per year) 
  var defaultLoanAmount = loans[0].loan_amount;
  $("#loan_amt0" + 1).val = defaultLoanAmount.toFixed(2); //js to Jquery, setting default loan amont(based on year) 
  var defaultInterestRate = loans[0].loan_int_rate;
  $("#loan_int0" + 1).val = defaultInterestRate;// js to Jquery, setting default intrest rate(based of amount and year)
  var loanWithInterest = loans[0].loan_amount * (1 + loans[0].loan_int_rate);
  $("#loan_bal0" + 1).innerHTML = toComma(loanWithInterest.toFixed(2)); //js to JQuery,
  
  // pre-fill defaults for other loan years
 
 for(var i=2; i<6; i++) {
    $("#loan_year0" + i).value = defaultYear++; //JS to JQuery, add a year to whatever the default year is initialized as
    $("#loan_year0" + i).disabled = true;
    document.getElementById("loan_year0" + i).style.backgroundColor = "gray";
    document.getElementById("loan_year0" + i).style.color = "white";
    $("#loan_amt0" + i).val = defaultLoanAmount.toFixed(2);
    $("#loan_int0" + i).val = defaultInterestRate;
    $("#loan_int0" + i).disabled = true;
    document.getElementById("loan_int0" + i).style.backgroundColor = "gray";
    document.getElementById("loan_int0" + i).style.color = "white";
   loanWithInterest = (loanWithInterest + defaultLoanAmount) * (1 + defaultInterestRate);
   $("#loan_bal0" + i).innerHTML = toComma(loanWithInterest.toFixed(2));
    } // end: "for" loop
  
  // all input fields: select contents on fucus
  $("#input[type=text]").focus(function() {
    $(this).select();
    $(this).css("background-color", "yellow");
  }); 
  $("input[type=text]").blur(function() {
    $(this).css("background-color", "white");
  });
  
  // set focus to first year: messes up codepen
  // $("#loan_year01").focus();
  $("#loan_year01").blur( function() {
    updateLoansArray();
  });
  
//} // end: function loadDoc()
  //jQuery to close
});


function toComma(value) {
    return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function updateLoansArray() {
  loans[0].loan_year = parseInt($("#loan_year01").val());
  for(var i=1; i<5; i++) {
    loans[i].loan_year = loans[0].loan_year + i;
    $("#loan_year0"+ (i+1) ).val(loans[i].loan_year);
  }
  let toMoney = (value) => { //return dollar amount of calculations
  return `\$${toComma(value.toFixed(2))}`;
}
  //Storeloans array data using localStorage.
localStorage["loans"] = JSON.stringify(datas);
// Retrieve
var stored_loans = JSON.parse(localStorage["loans"]);

  
}// --- ANGULAR ---

var app = angular.module('myApp', []);
app.controller('myCtrl', function($scope) {
  $scope.payments =[];
	$scope.populate = function (){
	  let totalLoan = loanWithInterest;
	  let interestRate = loans[0].loan_int_rate;
	  let r = interestRate/12;
	  let n = 10;
		//loan payment formula
		//https://www.thebalance.com/loan-payment-calculations-315564
	  let pay = 12 * (totalLoan / ((((1+r)**(n*12))-1)/(r *(1+r)**(n*12))));
		for (let i=0; i<9; i++){
			totalLoan -= pay
			let interest = totalLoan * interestRate;
			$scope.payments[i]={
			"year":loans[4].loan_year + i + 1,
			"paymentAmount": pay,
			"interestAmount": interest,
			"yearEndBalance": totalLoan += interest
			}
		}
		$scope.payments[9] ={
		  "year":loans[4].loan_year + 10,
		  "paymentAmount": totalLoan,
		  "interestAmount": 0,
		  "yearEndBalance":0,
		  "style":"background-color: yellow"
		  }
	}
})
    </script>
    
	</body>
</html>
